<!doctype html>
<html class="no-js" lang="zxx">

<head>

    <title>Burger</title>
   <%- include('partials/htmlHead')%> 
</head>

<body>
    <!--[if lte IE 9]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
        <![endif]-->

    <!-- header-start -->
        <%- include('partials/header', {active:'menu'})  %> 
  
    <!-- header-end -->

    <!-- bradcam_area_start -->
    <div class="bradcam_area breadcam_bg overlay">
        <h3>Edit Meals</h3>
    </div>
    <!-- bradcam_area_end -->

    <!-- best_burgers_area_start  -->
    <div class="best_burgers_area">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="section_title text-center mb-80">
                        <span>Burger Menu</span>
                        <h3>Best Ever Burgers</h3>
                    </div>
                </div>
            </div>
            <div class="row">
<!-- this is a dynamic way to change the meals showing with the array of objects passed in app.js -->
                <% for(let i= 0; i < meals.length; i++){%>
                <div class="col-xl-6 col-md-6 col-lg-6">
                    <div class="single_delicious d-flex align-items-center">
                        <div class="thumb">
                            <img class="mealPic" src=" <%= meals[i].imgUrl %> " alt="">
                        </div>
                        <div class="info">
                            <input type="text" class="mealTitle" name="" value="<%= meals[i].title %>">
                            <textarea class="mealDescription" cols="30" rows="5"><%= meals[i].description %></textarea>
                            <span>$<input type="number" style="width: 50px;"class="mealPrice" value="<%= meals[i].price %>"></span>
                            <!-- <div class="form-group">
                                <label for="mealImage">Meal Image</label> -->
                                <input type="file" class="form-control" name="mealImg" id="mealImage" accept="image/x-png,image/gif,image/jpeg">
                              <!-- </div> -->
                            <!-- added the width in the span only temporary would change it in css-->
                            <a href="#" class="btn btn-success mt-3 editBtn" mealid="<%=i%>">save</a>
                            <!-- mealid is an attribute not an id ! the i is the index -->
                            
                         </div>
                    </div>
                </div>
                <% } %>
            </div>
        </div>
    </div>
    <!-- best_burgers_area_end  -->




    <!-- footer_start  -->
    <footer class="footer">
            <div class="footer_top">
                <div class="container">
                    <div class="row">
                        <div class="col-xl-4 col-md-6 col-lg-4">
                            <div class="footer_widget text-center ">
                                <h3 class="footer_title pos_margin">
                                        New York
                                </h3>
                                <p>5th flora, 700/D kings road, <br> 
                                        green lane New York-1782 <br>
                                        <a href="#">info@burger.com</a></p>
                                <a class="number" href="#">+10 378 483 6782</a>

                            </div>
                        </div>
                        <div class="col-xl-4 col-md-6 col-lg-4">
                            <div class="footer_widget text-center ">
                                <h3 class="footer_title pos_margin">
                                    California
                                </h3>
                                <p>5th flora, 700/D kings road, <br> 
                                        green lane New York-1782 <br>
                                        <a href="#">info@burger.com</a></p>
                                <a class="number" href="#">+10 378 483 6782</a>

                            </div>
                        </div>
                        <div class="col-xl-4 col-md-12 col-lg-4">
                                <div class="footer_widget">
                                        <h3 class="footer_title">
                                                Stay Connected
                                        </h3>
                                        <form action="#" class="newsletter_form">
                                            <input type="text" placeholder="Enter your mail">
                                            <button type="submit">Sign Up</button>
                                        </form>
                                        <p class="newsletter_text">Stay connect with us to get exclusive offer!</p>
                                 </div>
                        </div>
                    </div>
                    <div class="row justify-content-center">
                        <div class="col-lg-4">
                            <div class="socail_links text-center">
                                    <ul>
                                        <li>
                                            <a href="#">
                                                <i class="ti-instagram"></i>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#">
                                                <i class="ti-twitter-alt"></i>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#">
                                                <i class="ti-facebook"></i>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#">
                                                <i class="fa fa-google-plus"></i>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="copy-right_text">
                <div class="container">
                    <div class="footer_border"></div>
                    <div class="row">
                        <div class="col-xl-12">
                            <p class="copy_right text-center">
                                <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="fa fa-heart-o" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                            </p>
                        </div>
                    </div>
                </div>
            </div>
    </footer>
    <!-- footer_end  -->

    <%- include('partials/htmlJS') %> 

    <!-- adding event click for all btns with class editBtn using vanilla javascript-->
<script>
 document.querySelectorAll('.editBtn').forEach(element =>{
     element.addEventListener('click', e =>{
         e.preventDefault()
        // alert(e.target.getAttribute('mealid')) // e.target will return the attribute of the current clicked element
       // e.target.parentElement.querySelector('.mealTitle').value
        const mealid = e.target.getAttribute('mealid')
        const mealTitle = e.target.parentElement.querySelector('.mealTitle').value
        const mealDescription = e.target.parentElement.querySelector('.mealDescription').value
        const mealPrice = e.target.parentElement.querySelector('.mealPrice').value 
        const imgFile = e.target.parentElement.querySelector('.form-control').files[0]

       console.log(mealImage);
       // build a form data
        const formData = new FormData()
        formData.append('mealid', mealid)
        formData.append('mealTitle', mealTitle)
        formData.append('mealDescription', mealDescription)
        formData.append('mealPrice', mealPrice)
        if(imgFile){
            formData.append('imgFile', imgFile)
        }
        
        //calling the function 
        postData_FormData('/admin/editmeal', formData).then(response =>{
           // console.log(response)
           if(response.status == 200){
               response.json().then(jsonData =>{
                   console.log(jsonData);
                   //! with e.target i am able to access the image with the click addeventlistener
                   e.target.parentElement.parentElement.querySelector('.mealPic').src = jsonData + "?" + new Date().getTime()
               })
           }
        })

       // posting the data with jqery ajax... will change to fetch vanilla js
    //    $.ajax({
    //        type:"POST",
    //        url:"/admin/editmeal",
    //        data:{
    //             mealid,   // normal its written  mealid: mealid; but because the value and attribute name are the same i can write it as i did
    //             mealTitle, 
    //             mealDescription, 
    //             mealPrice,
    //             mealImage
    //        },
    //       //dataType:"dataType",
    //        success: function(response){

    //        }
    //    });


 // send data using fetch // before calling this i need the form data before
 // calling the postData function
    // postData("/admin/editmeal", {
    //         mealid,
    //         mealTitle,
    //         mealDescription,
    //         mealPrice
    //    }).then(data =>{
    //  })   
   })
 })
 //send the data as json using fetch // i wont need this as i have now postData_FormData which i will call- so i dont need to comment this
 function postData(url = '', data = {}) {
    // Default options are marked with *
    // eslint-disable-next-line no-undef
    return fetch(url, {
      method: 'POST', // *GET, POST, PUT, DELETE, etc.
      mode: 'cors', // no-cors, cors, *same-origin
      cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
      credentials: 'same-origin', // include, *same-origin, omit
      headers: {
      'Content-Type': 'application/json'
       //'Content-Type': 'application/x-www-form-urlencoded'
      },
      redirect: 'follow', // manual, *follow, error
      referrer: 'no-referrer', // no-referrer, *client
      body: JSON.stringify(data) // body data type must match "Content-Type" header
    })
      .then(response => response) // parses JSON response into native Javascript objects
  }

  // sending file/form and data as form-data using fetch 
  function postData_FormData(url = '', formdata = {}) {  // same formdata as in body:formdata
    // Default options are marked with *
    // eslint-disable-next-line no-undef

    // for sending multiple data types we don't need all the other stuff like in postdata function. we just need the method and the body
    return fetch(url, {
      method: 'POST', // *GET, POST, PUT, DELETE, etc.
      body: formdata 
    })
      .then(response => response) // parses JSON response into native Javascript objects
  }

</script>

</body>

</html>